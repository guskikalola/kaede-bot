<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: modules/nsfw/imhorny.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: modules/nsfw/imhorny.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @memberof Commands
 */
const postSlashCommand = require("../../tools/postSlashCommand.js");
const replyInteraction = require("../../tools/replyInteraction.js");
const getDoujin = require("../../tools/getDoujin.js");
const { createCanvas, loadImage } = require('canvas');
exports.load = async () => {

    // Send the slash command body
    var slashCommand = {
        "name": "imhorny",
        "description": "Get a random set of doujins",
        "options": [
            {
            "name": "amount",
            "description": "amount of doujin to get (MAX 20)",
            "type": "4",
            "required": false,
            "choices": [
                {
                    "name": "Normalfag",
                    "value": 2
                },
                {
                    "name":"Weird",
                    "value": 4
                },
                {
                    "name":"Creep",
                    "value": 8
                },
                {
                    "name":"Degenerate",
                    "value":12
                },
                {
                    "name":"OH MY GOD",
                    "value":14
                },
                {
                    "name":"ASCENDED",
                    "value":20
                }
            ]

        }]
    }
    var slashCommandResponse = await postSlashCommand({
        body: slashCommand,
        type: "guild",
        guildId: "601546489004556289"
    });
    // TODO : Logging system
    console.log(slashCommandResponse);

};
exports.run = (context) => {
    var amount = 6;
    const HEIGHT = 240 * 2, WIDTH = 160 * 2;
    const doujins = [];
    
    if (context.data.options) amount = context.data.options[0].value; 
    
    /* Generate the horny set for the degenerate weeb */
    const hornySet = new Set();
    var sauces = "Sauces: ";

    var fetcher = setInterval(async () => {
        if (hornySet.size &lt;= amount) { 
            var doujin = await getDoujin();
            if (doujin) {
                hornySet.add(doujin);
                var image = await loadImage(doujin.pages[0])
                doujins.push({thumbnail:image,id:doujin.bookId});
            }
        } else {
            clearInterval(fetcher);
            var ctx = createCanvas(WIDTH*amount/2,HEIGHT*2).getContext("2d");
            var col = 0,row=0, prog=0;
            doujins.forEach(doujin => {
                if(col >= amount/2) {col = 0; row++}
                ctx.drawImage(doujin.thumbnail,col*WIDTH,row*HEIGHT,WIDTH,HEIGHT);
                sauces += doujin.id + " ";
                col++;
                prog++;
            })
            replyInteraction(context.interaction,{
                type:"image",
                content:sauces,
                image: {
                    name:"horny.jpeg",
                    buffer: ctx.canvas.toBuffer('image/jpeg', { name: "horny.jpeg"})
                }
            })
        }
    }, 1000);
}
exports.information = {
    "name": "ping",
    "description": "Checks the bot's ping"
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Commands.html">Commands</a></li></ul><h3>Classes</h3><ul><li><a href="module-Commands-CommandsModule.html">CommandsModule</a></li></ul><h3>Global</h3><ul><li><a href="global.html#findCommand">findCommand</a></li><li><a href="global.html#getDoujin">getDoujin</a></li><li><a href="global.html#postSlashCommand">postSlashCommand</a></li><li><a href="global.html#replyInteraction">replyInteraction</a></li><li><a href="global.html#runCommand">runCommand</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Sun Feb 21 2021 16:48:12 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
